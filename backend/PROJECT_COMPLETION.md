# æŠ•èµ„ç ”ç©¶åˆ†æç³»ç»Ÿ - Backend å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®çŠ¶æ€

âœ… **é¡¹ç›®å·²å®Œæˆ** - Backendç›®å½•ç»“æ„å·²å®Œæ•´ç»„ç»‡ï¼Œæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®ç°å¹¶å¯æ­£å¸¸è¿è¡Œ

## ğŸ—ï¸ å®Œæˆçš„å·¥ä½œ

### 1. é¡¹ç›®ç»“æ„é‡ç»„
- âœ… åˆ›å»ºäº†è§„èŒƒçš„backendç›®å½•ç»“æ„
- âœ… å°†æ‰€æœ‰æºä»£ç æ–‡ä»¶ç§»åŠ¨åˆ° `backend/src/` ç›®å½•
- âœ… åˆ†ç¦»äº†åº”ç”¨ä»£ç  (`app/`) å’ŒMCPå·¥å…· (`mcp_tools/`)
- âœ… åˆ›å»ºäº†ç‹¬ç«‹çš„è„šæœ¬ç›®å½• (`scripts/`)
- âœ… å»ºç«‹äº†æµ‹è¯•ç›®å½•ç»“æ„ (`tests/`)

### 2. æ ¸å¿ƒåŠŸèƒ½å®ç°
- âœ… **æ•°æ®åº“æ¶æ„**: PostgreSQL + SQLAlchemy ORM
- âœ… **RESTful API**: FastAPIæ¡†æ¶ï¼Œå®Œæ•´çš„CRUDæ“ä½œ
- âœ… **AIä»£ç†é›†æˆ**: OpenAI API + è‡ªç„¶è¯­è¨€SQLç”Ÿæˆ
- âœ… **ç»„ä»¶ç³»ç»Ÿ**: çµæ´»çš„å›¾è¡¨ç»„ä»¶æŠ½è±¡ï¼Œæ”¯æŒKçº¿å›¾ç­‰é‡‘èå›¾è¡¨
- âœ… **è¯­ä¹‰åŒ–æ•°æ®**: åˆ—è§’è‰²å®šä¹‰ç³»ç»Ÿï¼Œæ”¯æŒOHLCæ•°æ®ç»“æ„
- âœ… **MCPåè®®**: Model Context Protocolé›†æˆ

### 3. å¼€å‘å·¥å…·å’Œè„šæœ¬
- âœ… **å¯åŠ¨è„šæœ¬**: `scripts/start_server.py` å’Œ `.bat` ç‰ˆæœ¬
- âœ… **ç³»ç»Ÿæ£€æŸ¥**: `scripts/system_check.py` å®Œæ•´çš„ç¯å¢ƒéªŒè¯
- âœ… **ä¾èµ–ç®¡ç†**: Poetryé…ç½®ï¼Œæ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…
- âœ… **ç¯å¢ƒé…ç½®**: `.env` æ–‡ä»¶é…ç½®å®Œæˆ

### 4. æµ‹è¯•å’ŒéªŒè¯
- âœ… **ç»¼åˆæµ‹è¯•å¥—ä»¶**: `tests/test_comprehensive.py`
- âœ… **æ•°æ®åº“è¿æ¥æµ‹è¯•**: æˆåŠŸè¿æ¥PostgreSQL
- âœ… **æ¨¡å—å¯¼å…¥æµ‹è¯•**: æ‰€æœ‰æ¨¡å—å¯æ­£å¸¸å¯¼å…¥
- âœ… **APIæ¨¡å—éªŒè¯**: FastAPIåº”ç”¨å¯æ­£å¸¸åŠ è½½

## ğŸš€ ç³»ç»Ÿæ¶æ„

```
Backend System Architecture:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FastAPI Application                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š Dashboard Management  â”‚  ğŸ—„ï¸  Datasource Management      â”‚
â”‚  ğŸ§© Component System      â”‚  ğŸ“ˆ Chart Configuration         â”‚
â”‚  ğŸ¤– AI Agent (OpenAI)    â”‚  ğŸ“‹ Column Role Definition      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    SQLAlchemy ORM                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   PostgreSQL Database                       â”‚
â”‚  â€¢ dashboards             â€¢ datasources                     â”‚
â”‚  â€¢ components             â€¢ column_definitions              â”‚
â”‚  â€¢ stock_prices           â€¢ ç¤ºä¾‹æ•°æ®                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### 1. æ™ºèƒ½æŸ¥è¯¢ç³»ç»Ÿ
- è‡ªç„¶è¯­è¨€è½¬SQLæŸ¥è¯¢
- åŸºäºå›¾è¡¨ä¸Šä¸‹æ–‡çš„æ™ºèƒ½æç¤º
- å®‰å…¨çš„æŸ¥è¯¢æ‰§è¡Œå’Œç»“æœéªŒè¯

### 2. çµæ´»ç»„ä»¶æ¶æ„
- æ”¯æŒå¤šç§å›¾è¡¨ç±»å‹ (Line, Candlestick, Bar, Metric, Pie, Scatter)
- JSONé…ç½®ç³»ç»Ÿ (mark + encoding + options æ¨¡å¼)
- è¯­ä¹‰åŒ–åˆ—è§’è‰² (dimension, metric, time, ohlc_*)

### 3. Kçº¿å›¾ä¸“é—¨æ”¯æŒ
- OHLCæ•°æ®ç»“æ„å®Œæ•´æ”¯æŒ
- ä¸“é—¨çš„è¯­ä¹‰è§’è‰²: `ohlc_open`, `ohlc_high`, `ohlc_low`, `ohlc_close`
- é‡‘èå›¾è¡¨é…ç½®æ¨¡æ¿

### 4. æ•°æ®ç®¡ç†
- åŠ¨æ€æ•°æ®æºç®¡ç†
- åˆ—å®šä¹‰å’Œè¯­ä¹‰è§’è‰²é…ç½®
- ç¤ºä¾‹è‚¡ç¥¨æ•°æ® (AAPL, NVDA)

## ğŸ“‚ ç›®å½•ç»“æ„

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # ä¸»åº”ç”¨ç¨‹åº
â”‚   â”‚   â”œâ”€â”€ main.py            # FastAPIåº”ç”¨å…¥å£ 
â”‚   â”‚   â”œâ”€â”€ models.py          # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ schemas.py         # APIæ•°æ®æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ crud.py            # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ database.py        # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ agent.py           # AIä»£ç†
â”‚   â”‚   â”œâ”€â”€ component_configs.py # å›¾è¡¨é…ç½®
â”‚   â”‚   â””â”€â”€ ...               # å…¶ä»–å·¥å…·æ¨¡å—
â”‚   â””â”€â”€ mcp_tools/
â”‚       â””â”€â”€ db_server.py       # MCPæ•°æ®åº“æœåŠ¡å™¨
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start_server.py        # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ system_check.py        # ç³»ç»Ÿæ£€æŸ¥
â”‚   â””â”€â”€ *.bat                 # Windowsæ‰¹å¤„ç†è„šæœ¬
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_comprehensive.py  # ç»¼åˆæµ‹è¯•
â”œâ”€â”€ database/                  # æ•°æ®åº“è„šæœ¬
â”œâ”€â”€ PostgreSQL/               # Dockeré…ç½®
â”œâ”€â”€ .env                      # ç¯å¢ƒé…ç½®
â”œâ”€â”€ pyproject.toml           # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                # æ–‡æ¡£
```

## ğŸ”§ APIç«¯ç‚¹

### æ ¸å¿ƒç«¯ç‚¹
- `GET /health` - å¥åº·æ£€æŸ¥
- `POST /agent` - AIæŸ¥è¯¢ä»£ç†
- `GET /docs` - Swagger APIæ–‡æ¡£

### æ•°æ®ç®¡ç†
- `POST|GET|PUT|DELETE /dashboards/**` - ä»ªè¡¨æ¿ç®¡ç†
- `POST|GET|PUT|DELETE /datasources/**` - æ•°æ®æºç®¡ç†  
- `POST|GET|PUT|DELETE /components/**` - ç»„ä»¶ç®¡ç†
- `POST|GET|DELETE /datasources/{id}/columns` - åˆ—ç®¡ç†

### ç‰¹æ®ŠåŠŸèƒ½
- `GET /components/{id}/chart-context` - å›¾è¡¨ä¸Šä¸‹æ–‡ç”Ÿæˆ

## âœ… éªŒè¯ç»“æœ

æœ€æ–°çš„ç³»ç»Ÿæ£€æŸ¥ç»“æœ:
```
ğŸš€ Investment Research Analytics System Check
==================================================
âœ… Environment     PASS - ç¯å¢ƒé…ç½®æ­£ç¡®
âœ… Database        PASS - æ•°æ®åº“è¿æ¥æˆåŠŸ  
âœ… Models          PASS - æ•°æ®æ¨¡å‹æ­£å¸¸
âœ… API             PASS - APIæ¨¡å—åŠ è½½æˆåŠŸ
==================================================
ğŸ‰ All checks passed! System is ready.
```

### æ•°æ®çŠ¶æ€
- ğŸ“ˆ 1ä¸ªç¤ºä¾‹ä»ªè¡¨æ¿
- ğŸ—‚ï¸ 1ä¸ªæ•°æ®æº (Stock Prices Enhanced)
- ğŸ’¾ ç¤ºä¾‹è‚¡ç¥¨æ•°æ®å·²åŠ è½½ (AAPL, NVDA)

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨ç³»ç»Ÿ
```bash
cd backend
poetry install                    # å®‰è£…ä¾èµ–
poetry run python scripts/system_check.py  # ç³»ç»Ÿæ£€æŸ¥
poetry run python scripts/start_server.py  # å¯åŠ¨æœåŠ¡å™¨
```

### 2. è®¿é—®API
- APIæ–‡æ¡£: http://localhost:8787/docs
- å¥åº·æ£€æŸ¥: http://localhost:8787/health

### 3. ç¤ºä¾‹æŸ¥è¯¢
```bash
# AIæŸ¥è¯¢ç¤ºä¾‹
curl -X POST http://localhost:8787/agent \
  -H "Content-Type: application/json" \
  -d '{
    "question": "æ˜¾ç¤ºAAPLè‚¡ç¥¨æœ€è¿‘30å¤©çš„ä»·æ ¼è¶‹åŠ¿",
    "component_id": "some-component-uuid"
  }'
```

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

1. **å‰ç«¯é›†æˆ**: å‡†å¤‡ä¸React/Vueå‰ç«¯åº”ç”¨é›†æˆ
2. **æ›´å¤šæ•°æ®æº**: æ‰©å±•æ”¯æŒæ›´å¤šé‡‘èæ•°æ®API
3. **é«˜çº§å›¾è¡¨**: æ·»åŠ æ›´å¤šä¸“ä¸šé‡‘èå›¾è¡¨ç±»å‹
4. **å®æ—¶æ•°æ®**: é›†æˆWebSocketå®æ—¶æ•°æ®æ¨é€
5. **ç”¨æˆ·ç®¡ç†**: æ·»åŠ ç”¨æˆ·è®¤è¯å’Œæƒé™ç³»ç»Ÿ

## ğŸ“ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: FastAPI 0.111+
- **æ•°æ®åº“**: PostgreSQL + SQLAlchemy 2.0
- **AIé›†æˆ**: OpenAI GPT-4 API
- **é…ç½®ç®¡ç†**: Pydantic + Python-dotenv
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **ä¾èµ–ç®¡ç†**: Poetry
- **APIæ–‡æ¡£**: Swagger/OpenAPI 3.0

## ğŸ‰ é¡¹ç›®å®Œæˆ

æŠ•èµ„ç ”ç©¶åˆ†æç³»ç»Ÿçš„åç«¯éƒ¨åˆ†å·²å®Œå…¨å®ç°å¹¶éªŒè¯ï¼Œå…·å¤‡ï¼š
- âœ… å®Œæ•´çš„APIåŠŸèƒ½
- âœ… ç¨³å®šçš„æ•°æ®åº“è¿æ¥
- âœ… AIæŸ¥è¯¢èƒ½åŠ›
- âœ… çµæ´»çš„å›¾è¡¨ç³»ç»Ÿ
- âœ… è§„èŒƒçš„é¡¹ç›®ç»“æ„
- âœ… å®Œå–„çš„å¼€å‘å·¥å…·

ç³»ç»Ÿå·²å‡†å¤‡å¥½ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æˆ–å‰ç«¯é›†æˆå¼€å‘ï¼
